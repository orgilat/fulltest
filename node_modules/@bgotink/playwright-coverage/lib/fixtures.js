"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.mixinFixtures = mixinFixtures;
const fs_1 = require("fs");
const data_1 = require("./data");
const coverageFixtures = {
    collectCoverage: [true, { option: true }],
    page: async ({ page, collectCoverage, browserName }, use, testInfo) => {
        if (browserName !== 'chromium' || !collectCoverage) {
            return use(page);
        }
        await page.coverage.startJSCoverage({
            resetOnNavigation: false,
        });
        await use(page);
        const result = await page.coverage.stopJSCoverage();
        const resultFile = testInfo.outputPath('v8-coverage.json');
        await fs_1.promises.writeFile(resultFile, JSON.stringify({ result }));
        testInfo.attachments.push({
            name: data_1.attachmentName,
            contentType: 'application/json',
            path: resultFile,
        });
    },
};
function mixinFixtures(base) {
    return base.extend(coverageFixtures);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZml4dHVyZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZml4dHVyZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFnREEsc0NBS0M7QUE3Q0QsMkJBQWtDO0FBRWxDLGlDQUFzQztBQU10QyxNQUFNLGdCQUFnQixHQUtsQjtJQUNGLGVBQWUsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBRTtJQUUxQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUMsSUFBSSxFQUFFLGVBQWUsRUFBRSxXQUFXLEVBQUMsRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLEVBQUU7UUFDbEUsSUFBSSxXQUFXLEtBQUssVUFBVSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDbkQsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkIsQ0FBQztRQUVELE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUM7WUFDbEMsaUJBQWlCLEVBQUUsS0FBSztTQUN6QixDQUFDLENBQUM7UUFFSCxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVoQixNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFcEQsTUFBTSxVQUFVLEdBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQzNELE1BQU0sYUFBRSxDQUFDLFNBQVMsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFDLE1BQU0sRUFBQyxDQUFDLENBQUMsQ0FBQztRQUV6RCxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztZQUN4QixJQUFJLEVBQUUscUJBQWM7WUFDcEIsV0FBVyxFQUFFLGtCQUFrQjtZQUMvQixJQUFJLEVBQUUsVUFBVTtTQUNqQixDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YsQ0FBQztBQUVGLFNBQWdCLGFBQWEsQ0FHM0IsSUFBb0I7SUFDcEIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFDdkMsQ0FBQyJ9